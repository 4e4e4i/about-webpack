# Webpack (version 2.0)

Webpack - сборщик модулей на проекте. Обычно ваш проект состоит из JS файлов, стилей, шаблонизаторов
и тд. Помимо этого все эти модули переплетены зависимостями и после того, как эти файлы пройдут через
webpack, мы получим просто основные статические сущности, которые правильно разложены по зависимостям.  

![webpack_scheme](assets/webpack.png)


## Что предоставляет Webpack

* Поддержка модулей (так же он поддерживает нативный ES6 синтаксис)

    * AMD
    * Common.js
    
* Пакетные мендеджеры (может спокойной подключать различные библиотеки, которые были установлены за
счет данных пакетных менеджеров)

    * NPM
    * Bower
    
* Live Reload (это обновление контента без перезагрузки страницы браузера)

    * Hot Module Replacement (если поменяем JS код, то окно бразера не перезагрузится, а изменения
    будут пременены)


### Какие проблемы решает Webpack

* Правильный порядок скриптов (сам смотрит на зависимости скриптов и подключает в правильно порядке)
* Правильные зависимости подключены
* (на каждой странице)
* Лимит подключения скриптов
* Без использования пакетных менеджеров приходилось копировать исходный код библиотке

### Что такое Webpack

* Webpack инструмент для совмещения модулей, а не таск раннер (как gulp или grunt)

* Анализирует дерево зависимостей (не только JS, но и CSS, картинки, HTML и тд)

* Понимает разные стандарты модулей (Common.js, AMD ...)

* Webpack2 понимает ES6 импорты и экспорты

### Зачем он был разработан

* Разделение кода (декомпозиция) и загрузка модулей по требованию
* Уменьшение скорости загрузки страниц (объединение модулей, минификация)
* Статические сущности (шрифты, картинки) - тоже модули которые можно обрабатывать
* Понимание NodeJS модулей (для работы со сторонними библиотеками)
* Подходит для больших проектов

### Различия

* Может использовать NPM
* У каждого модуля есть свои зависимости, которые Webpack отлично понимает
* Нет глобальных переменных (если мы сами их не создадим)
* Все загружается в нужном порядке (если нет рекурсии)
* Возможность тестирования каждого меодуля отдельно

#### Первый запуск

Установка глобально пакета Webpack и в папке с файлами js можно выполнить webpack init.js -o out.js,
чтобы собрать все файлы в один bundle.

### Командные интерфейсы webpack

В данной команде webpack по дефолту создает файл для продакшена и сразу минифицырует выходной бандл,
чтобы собрать файл для разработки необходимо задать mode development:
```
webpack --mode=development init.js -o out-d.js
```

Для того чтобы войти в режим "вотчинга" за изменениями в файлах js мы так же можем прописать команду
```
webpack init.js -o out-d.js -d --watch
```

Теперь при любых изменениях в файлах, вебпак будет пересобирать данный bundle

#### Source maps

C помощью команды мы можем добавить в модули функцию eval, которая компилирует входящую строку и добавляет
source map (работает с открытой консолью):

```
webpack init.js -o out-d.js -d
```

Подсветка в консоле с помощью команды

```
webpack init.js -o out-d.js --colors
```

### Работа с Webpack config

Для этого необходимо в корне проекта на одном уровне с папкой src создать файл webpack.config.js

Основная особенность данного файла (из-за того что он работает на платформе NodeJS) он должен экспортировать
из себя некий объект, делается это с помощью конструкции module.exports. В NodeJS единичный js файл
является модулем и у него есть глобальный объект module, у которого есть объект exports, в который мы можем положить
объект:

```
module.exports = {}
```

И далее в этом объекте мы будем описывать ключи в синтаксисе JS и значения - конфигурация webpack'а

* Сначала установим точку входа через ключ **entry** - это наш init.js.
* Для того чтобы webpack смог найти наш файл, который, например находится в папке src, нам необходимо подключить 
специальный модуль, который встроен в nodeJS - path в начале файла.

```
const path = require('path')
```
и  помощью данного модуля мы будем указывать пути и разрешать их удобным способом. Так же добавим поле context
которое будет говорить вебпаку о том, где находится данный файл абсолютным путем. В ней мы укажем path.resolve,
для того чтобы он нам разрулил путь, в резолв мы укажем глобальную переменную в NodeJS - __dirname, которая будет отвечать
за путь к данной директории и вторым параметром саму папку src

```
module.exports = {
    context: path.resolve(__dirname, 'src')
}    
```

* Далее как основной параметр, который должен пристуствовать - свойство output, которое является объектом и
у него есть 2 свойства: filename - название файла бандла и path - путь где разместить данный bundle

```
module.exports = {
    context: path.resolve(__dirname, 'src'),
    
    entry: './init.js',
    
    output: {
        filename: 'bundle.js',
        path: path.resolve(__dirname, 'dist')
    }
}    
```

Рассмотрим еще 2 конфигурации. Это поле resolve - объект, у него есть поле extensions - array и здесь
мы можем указать строку '.js'. Данный параметр прописывается по-умолчанию, он означает, что мы можем подключать
какие-либо определенные сущности, т.е. когда мы делаем импорты картинок, стилей или скриптов, вебпак разрешает не писать
формат файла в пути благодаря данному параметру.

И еще один параметр - watch. По умолчанию - false, он позволяет компилировать бандл на лету.

#### Множественные точки входа

Например если есть сайт, у которого множество страниц и на каждой странице используются определенные скрипты. При этом
есть библиотеки общие, которые хотелось бы использовать в рамках одного проекта.

Для того чтобы использовать несколько точек входа, поле entry может принимать объект и каждый ключ - точка входа,
а его значение - путь до файла js.

Для того чтобы получить несколько бандлов, у вебпака есть небольшой такой шаблонизатор, в output поле filename мы
в строке укажем [name].js, то бандлы будут называться исходя из названий ключей, указанных в entry.

#### Исходные карты

Можно добавлять дополнительное поле devtool со значением 'eval' для первого типа исходных карт.
Следующий тип карт - 'source-map'. Создает отдельный файл map с исходными картами. Есть и другие, можно посмотреть в документации.


